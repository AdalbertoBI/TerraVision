<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="cache-control" content="no-store, no-cache, must-revalidate" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="expires" content="0" />
        <meta name="description" content="Terra Vision â€” interface musicoterapÃªutica com controle por olhar e piscada." />
        <title>Terra Vision Â· Interface ocular para mÃºsica terapÃªutica</title>
        <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='15' fill='%2305182b'/%3E%3Cpath d='M16 8a9 9 0 1 0 9 9 9 9 0 0 0-9-9zm0 14a5 5 0 1 1 5-5 5 5 0 0 1-5 5z' fill='%234fc3f7'/%3E%3Ccircle cx='16' cy='17' r='2.5' fill='%23fbc02d'/%3E%3C/svg%3E" />
        <link rel="stylesheet" href="style.css?v=dev" />
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" defer></script>
    <script src="libs/webgazer.js" defer onerror="document.body.setAttribute('data-webgazer-missing','true');"></script>
    </head>
    <body>
        <noscript>
            <div class="noscript" role="alert">
                Ative o JavaScript para utilizar o Terra Vision com rastreamento ocular.
            </div>
        </noscript>

        <main class="stage" aria-label="Pizza musical interativa">
            <canvas id="pizza-canvas" aria-label="Pizza com notas musicais" role="img"></canvas>
            <canvas id="heatmap-canvas" aria-hidden="true"></canvas>
            <div class="stage-center">
                <video
                    id="webcam"
                    autoplay
                    muted
                    playsinline
                    width="640"
                    height="480"
                    aria-label="PrÃ©-visualizaÃ§Ã£o da cÃ¢mera frontal"
                ></video>
            </div>
            <div id="gaze-dot" aria-hidden="true"></div>
        </main>

        <div id="gazeCursor" aria-hidden="true"></div>

        <section id="status" class="status-bar" role="status" aria-live="polite" aria-atomic="true">
            <span id="status-text">
                Olhe para a pizza colorida; a cÃ¢mera abrirÃ¡ automaticamente para iniciar o rastreamento.
            </span>
            <button type="button" class="calibrate-chip" data-action="calibrate" aria-label="Iniciar nova calibraÃ§Ã£o">
                <span aria-hidden="true">ðŸŽ¯</span>
                <span>Calibrar</span>
            </button>
        </section>

        <script>
            (function ensureSecureContext() {
                const statusEl = document.getElementById('status');
                const statusText = document.getElementById('status-text');
                const host = window.location.hostname;
                const isLocalhost = host === 'localhost';
                if (window.location.protocol === 'file:') {
                    statusText && (statusText.textContent = 'Execute o Terra Vision a partir de um servidor local gratuito (ex.: python -m http.server 8000) em http://localhost para habilitar o rastreamento ocular.');
                } else if (window.location.protocol === 'http:' && host && !isLocalhost) {
                    statusText && (statusText.textContent = `Abra o projeto usando a URL http://localhost (endereÃ§o atual: ${host}). O WebGazer sÃ³ funciona em https ou localhost.`);
                }
            })();
            window.addEventListener('DOMContentLoaded', () => {
                const statusText = document.getElementById('status-text');
                if (document.body.dataset.webgazerMissing === 'true' && statusText) {
                    statusText.textContent = 'Arquivo libs/webgazer.js nÃ£o encontrado. Execute o script setup-webgazer.bat ou .sh para baixar a versÃ£o local.';
                }
            });
        </script>
    <script src="src/main.js?v=dev" type="module" defer></script>
    </body>
</html>
